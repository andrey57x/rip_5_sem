basePath: /api/v1
definitions:
  apitypes.MassCalculationJSON:
    properties:
      creator_login:
        type: string
      date_create:
        type: string
      date_finish:
        type: string
      date_form:
        type: string
      id:
        type: integer
      moderator_login:
        type: string
      output_koef:
        type: number
      status:
        type: string
    type: object
  apitypes.ReactionCalculationJSON:
    properties:
      calculation_id:
        type: integer
      id:
        type: integer
      input_mass:
        type: number
      output_mass:
        type: number
      reaction_id:
        type: integer
    type: object
  apitypes.ReactionJSON:
    properties:
      conversation_factor:
        type: number
      description:
        type: string
      id:
        type: integer
      img_link:
        type: string
      product:
        type: string
      reagent:
        type: string
      title:
        type: string
    type: object
  apitypes.StatusJSON:
    properties:
      status:
        type: string
    type: object
  apitypes.UserJSON:
    properties:
      is_moderator:
        type: boolean
      login:
        type: string
      password:
        type: string
    type: object
  handler.MassCalculationResponse:
    properties:
      calculation:
        $ref: '#/definitions/apitypes.MassCalculationJSON'
      reactions:
        items:
          $ref: '#/definitions/handler.ReactionWithOutput'
        type: array
    type: object
  handler.ReactionWithOutput:
    properties:
      input_mass:
        type: number
      output_mass:
        type: number
      reaction:
        $ref: '#/definitions/apitypes.ReactionJSON'
    type: object
host: localhost:8080
info:
  contact: {}
  description: API для работы с реакциями
  title: Reactions API
  version: "1.0"
paths:
  /mass-calculations:
    get:
      description: Возвращает список расчетов с возможностью фильтрации по диапазону
        дат и статусу.
      parameters:
      - description: Нижняя граница даты (YYYY-MM-DD)
        in: query
        name: from-date
        type: string
      - description: Верхняя граница даты (YYYY-MM-DD)
        in: query
        name: to-date
        type: string
      - description: Статус расчета (draft, formed, moderated, deleted)
        in: query
        name: status
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список расчетов
          schema:
            items:
              $ref: '#/definitions/apitypes.MassCalculationJSON'
            type: array
        "400":
          description: Неверный формат даты или параметров запроса"}
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Не найдены записи
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Получить список расчетов
      tags:
      - mass-calculations
  /mass-calculations/{id}:
    delete:
      description: Помечает расчет как удалённый. Доступ — владелец или модератор.
        Возвращает {"message":"Calculation deleted"}.
      parameters:
      - description: ID расчета
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: message
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Неверный формат запроса
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Расчет не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Удалить расчет (логическое удаление)
      tags:
      - mass-calculations
    get:
      description: Возвращает расчет и список реакций, входящих в неё, с рассчитанными
        массами.
      parameters:
      - description: ID расчета
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Объект расчета с реакциями
          schema:
            $ref: '#/definitions/handler.MassCalculationResponse'
        "400":
          description: Некорректный ID
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Расчет не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Получить расчет по ID
      tags:
      - mass-calculations
    put:
      consumes:
      - application/json
      description: 'Обновляет расчет по ID: принимает JSON расчета и возвращает обновлённый
        объект.'
      parameters:
      - description: ID расчета
        in: path
        name: id
        required: true
        type: integer
      - description: Тело запроса — объект расчета
        in: body
        name: calculation
        required: true
        schema:
          $ref: '#/definitions/apitypes.MassCalculationJSON'
      produces:
      - application/json
      responses:
        "200":
          description: Обновлённый расчет
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "400":
          description: Неверный формат запроса или тела
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Расчет не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Изменить поля расчета
      tags:
      - mass-calculations
  /mass-calculations/{id}/form:
    put:
      description: Переводит расчет в статус formed — доступен только создателю.
      parameters:
      - description: ID расчета
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Расчет успешно сформирована
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "400":
          description: Неверный формат запроса
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Только создатель может формировать расчет
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Расчет не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Сформировать расчет
      tags:
      - mass-calculations
  /mass-calculations/{id}/moderate:
    put:
      consumes:
      - application/json
      description: Устанавливает статус расчета — только модератор может это сделать.
      parameters:
      - description: ID расчета
        in: path
        name: id
        required: true
        type: integer
      - description: Тело запроса с полем status
        in: body
        name: status
        required: true
        schema:
          $ref: '#/definitions/apitypes.StatusJSON'
      produces:
      - application/json
      responses:
        "200":
          description: Расчет после модерации
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "400":
          description: Некорректные входные данные"}
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Неавторизован"}
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Только модератор может модерацию
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Расчет не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Модерировать расчет (только модератор)
      tags:
      - mass-calculations
  /mass-calculations/calculation-cart:
    get:
      description: Возвращает количество реакций в текущей корзине пользователя и
        ID черновика расчета (если есть).
      produces:
      - application/json
      responses:
        "200":
          description: 'Поля: id (int, -1 если нет черновика), reactions_count (int)'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Некорректный запрос (например, неверный токен)"}
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Черновик не найден
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Получить карточку черновика расчета для пользователя
      tags:
      - mass-calculations
  /reaction-calculations/{mass_calculation_id}/{reaction_id}:
    delete:
      description: Удаляет связь реакции и расчета и возвращает обновлённый расчет.
      parameters:
      - description: ID расчета
        in: path
        name: mass_calculation_id
        required: true
        type: integer
      - description: ID реакции
        in: path
        name: reaction_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Обновлённый расчет
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "400":
          description: Некорректный ID
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Не найдено
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Удалить реакцию из расчета
      tags:
      - reaction-calculations
    put:
      consumes:
      - application/json
      description: Обновляет поле расчёта реакции (output mass).
      parameters:
      - description: ID расчета
        in: path
        name: mass_calculation_id
        required: true
        type: integer
      - description: ID реакции
        in: path
        name: reaction_id
        required: true
        type: integer
      - description: Новые значения расчёта
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/apitypes.ReactionCalculationJSON'
      produces:
      - application/json
      responses:
        "200":
          description: Обновлённый расчёт
          schema:
            $ref: '#/definitions/apitypes.ReactionCalculationJSON'
        "400":
          description: Некорректный запрос
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Не найдено
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Изменить поле связи многие ко многим
      tags:
      - reaction-calculations
  /reactions:
    get:
      description: Возвращает все реакции или фильтрует по параметру reaction_title.
      parameters:
      - description: Фильтр по заголовку реакции
        in: query
        name: reaction_title
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список реакций
          schema:
            items:
              $ref: '#/definitions/apitypes.ReactionJSON'
            type: array
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Получить список реакций
      tags:
      - reactions
    post:
      consumes:
      - application/json
      description: Создаёт новую реакцию, возвращает Location в заголовках и объект
        реакции.
      parameters:
      - description: Данные реакции
        in: body
        name: reaction
        required: true
        schema:
          $ref: '#/definitions/apitypes.ReactionJSON'
      produces:
      - application/json
      responses:
        "201":
          description: Реакция создана
          schema:
            $ref: '#/definitions/apitypes.ReactionJSON'
        "400":
          description: Неверный запрос
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Создать реакцию
      tags:
      - reactions
  /reactions/{id}:
    delete:
      description: Логическое удаление реакции. Возвращает {"status":"deleted"}.
      parameters:
      - description: ID реакции
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: status
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Неверный ID
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Реакция не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Удалить реакцию
      tags:
      - reactions
    get:
      description: Возвращает реакцию по id.
      parameters:
      - description: ID реакции
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Реакция
          schema:
            $ref: '#/definitions/apitypes.ReactionJSON'
        "400":
          description: Неверный ID
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Реакция не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Получить реакцию по ID
      tags:
      - reactions
    put:
      consumes:
      - application/json
      description: Обновляет реакцию по ID.
      parameters:
      - description: ID реакции
        in: path
        name: id
        required: true
        type: integer
      - description: Новые данные реакции
        in: body
        name: reaction
        required: true
        schema:
          $ref: '#/definitions/apitypes.ReactionJSON'
      produces:
      - application/json
      responses:
        "200":
          description: Обновлённая реакция
          schema:
            $ref: '#/definitions/apitypes.ReactionJSON'
        "400":
          description: Неверный запрос
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Реакция не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Обновить реакцию
      tags:
      - reactions
  /reactions/{id}/add-to-calculation:
    post:
      description: Добавляет реакцию в черновик пользователя (если черновика нет —
        создаёт). Возвращает сам расчет.
      parameters:
      - description: ID реакции
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Если добавление в существующий черновик
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "201":
          description: Если был создан новый черновик
          schema:
            $ref: '#/definitions/apitypes.MassCalculationJSON'
        "400":
          description: Ошибка запроса или авторизации
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Реакция/калькуляция не найдены
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Добавить реакцию в текущий черновик расчета
      tags:
      - mass-calculations
  /reactions/{id}/image:
    post:
      consumes:
      - multipart/form-data
      description: 'Загружает файл изображения и возвращает объект вида {"status":"uploaded",
        "reaction": <ReactionJSON>}.'
      parameters:
      - description: ID реакции
        in: path
        name: id
        required: true
        type: integer
      - description: Изображение
        in: formData
        name: image
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: status (string) и reaction (apitypes.ReactionJSON)
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Неверный запрос/файл
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Реакция не найдена
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Загрузить изображение для реакции
      tags:
      - reactions
  /users/{login}/profile:
    get:
      description: Возвращает данные профиля (доступен только тот, чей UUID совпадает
        с user_id в токене).
      parameters:
      - description: Логин пользователя
        in: path
        name: login
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Профиль пользователя
          schema:
            $ref: '#/definitions/apitypes.UserJSON'
        "400":
          description: Проблема с авторизацией/получением user_id"}
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Пользователи не совпадают
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Пользователь не найден
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Получить профиль пользователя
      tags:
      - users
    put:
      consumes:
      - application/json
      description: Обновляет профиль пользователя (может делать только сам пользователь).
      parameters:
      - description: Логин пользователя
        in: path
        name: login
        required: true
        type: string
      - description: Новые данные профиля
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/apitypes.UserJSON'
      produces:
      - application/json
      responses:
        "200":
          description: Обновлённый профиль
          schema:
            $ref: '#/definitions/apitypes.UserJSON'
        "400":
          description: Ошибка запроса или авторизации
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Доступ запрещён
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Пользователь не найден
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Изменить профиль пользователя
      tags:
      - users
  /users/sign-in:
    post:
      consumes:
      - application/json
      description: Принимает логин/пароль, возвращает jwt-токен в формате {"token":"..."}.
      parameters:
      - description: Логин и пароль
        in: body
        name: credentials
        required: true
        schema:
          $ref: '#/definitions/apitypes.UserJSON'
      produces:
      - application/json
      responses:
        "200":
          description: token
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Неверный запрос
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Пользователь не найден
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Вход (получение токена)
      tags:
      - users
  /users/sign-out:
    post:
      description: Удаляет токен текущего пользователя из хранилища. Возвращает {"status":"signed_out"}.
      produces:
      - application/json
      responses:
        "200":
          description: status
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Проблема с получением user_id
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка при удалении токена
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Выход (удаление токена)
      tags:
      - users
  /users/sign-up:
    post:
      consumes:
      - application/json
      description: Регистрирует нового пользователя. Возвращает URL созданного ресурса
        в Location и тело созданного пользователя.
      parameters:
      - description: Параметры нового пользователя
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/apitypes.UserJSON'
      produces:
      - application/json
      responses:
        "201":
          description: Пользователь создан
          schema:
            $ref: '#/definitions/apitypes.UserJSON'
        "400":
          description: Ошибка валидации или входных данных
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Внутренняя ошибка сервера
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Регистрация пользователя
      tags:
      - users
securityDefinitions:
  ApiKeyAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
